<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.csst.hotelCrawler.dao.HotelScoreDao" >
  <resultMap id="BaseResultMap" type="com.csst.hotelCrawler.entity.HotelScore" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 13 09:10:00 CST 2015.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="datasource" property="datasource" jdbcType="VARCHAR" />
    <result column="hotelId" property="hotelid" jdbcType="INTEGER" />
    <result column="position" property="position" jdbcType="DOUBLE" />
    <result column="facility" property="facility" jdbcType="DOUBLE" />
    <result column="service" property="service" jdbcType="DOUBLE" />
    <result column="health" property="health" jdbcType="DOUBLE" />
    <result column="score" property="score" jdbcType="DOUBLE" />
    <result column="crawlerDate" property="crawlerdate" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <insert id="insert" parameterType="com.csst.hotelCrawler.entity.HotelScore" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 13 09:10:00 CST 2015.
    -->
    insert into hotelScore (id, datasource, hotelId, 
      position, facility, service, 
      health, score,crawlerDate)
    values (#{id,jdbcType=INTEGER}, #{datasource,jdbcType=VARCHAR}, #{hotelid,jdbcType=INTEGER}, 
      #{position,jdbcType=DOUBLE}, #{facility,jdbcType=DOUBLE}, #{service,jdbcType=DOUBLE}, 
      #{health,jdbcType=DOUBLE}, #{score,jdbcType=DOUBLE}, #{crawlerdate,jdbcType=TIMESTAMP})
  </insert>
  
    <insert id="insertTmp" parameterType="com.csst.hotelCrawler.entity.HotelScore" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 13 09:10:00 CST 2015.
    -->
    insert into hotelScore_tmp (id, datasource, hotelId, 
      position, facility, service, 
      health, score,crawlerDate)
    values (#{id,jdbcType=INTEGER}, #{datasource,jdbcType=VARCHAR}, #{hotelid,jdbcType=INTEGER}, 
      #{position,jdbcType=DOUBLE}, #{facility,jdbcType=DOUBLE}, #{service,jdbcType=DOUBLE}, 
      #{health,jdbcType=DOUBLE}, #{score,jdbcType=DOUBLE}, #{crawlerdate,jdbcType=TIMESTAMP})
  </insert>
  
  <insert id="copyToHistory">
  insert into hotelScore_history( datasource, hotelId, 
      position, facility, service, 
      health, score,crawlerDate) (select  datasource, hotelId, 
      position, facility, service, 
      health, score,crawlerDate from hotelScore )
  </insert>
  
    <insert id="copyToHotelScore">
  insert into hotelScore(select * from hotelScore_tmp )
  </insert>
  
  <select id="queryByHotelId" resultMap="HotelScoreVo">
                select hotelScore.* ,IF(sum(commentStatistic.count)/10000>1,5,SQRT(sum(commentStatistic.count)/10000)*5)
                 hot,
                 IF(sum(commentStatistic.pos)/2500>1,5,SQRT(sum(commentStatistic.pos)/2500)*5) pos
                 from hotelScore,commentStatistic 
                 where hotelScore.hotelID in
                 
                  <foreach item="item" index="index" collection="array" 
                         open="(" separator="," close=")">
                        #{item}
                 </foreach>
                 and 
				commentStatistic.hotelId = hotelScore.hotelId
				GROUP BY commentStatistic.hotelId
                 
                 
  </select> 
  
  <select id="queryScoreHistroy" resultMap="BaseResultMap">
  select * from  hotelScore_history 
  where hotelId in 
     <foreach item="item" index="index" collection="array" 
                         open="(" separator="," close=")">
                        #{item}
     </foreach>
  </select>
  
  <select id="countTmp" resultType="java.lang.Integer">
  select count(*) from hotelScore_tmp
  </select>
  
  <delete id="deleteHotelScore">
  delete from hotelScore
  </delete>
  
   <delete id="deleteHotelScoreTmp">
  delete from hotelScore_tmp
  </delete>  
   
  
 	<!-- 为了返回list 类型而定义的returnMap -->
	<resultMap type="HotelScoreVo" autoMapping="true" id="HotelScoreVo">
	</resultMap>
  
</mapper>